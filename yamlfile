trigger:
- master


jobs:
- job: BuildAndTest
  workspace:
    clean: all
  pool:
    vmImage: windows-2019
  steps:
  - script: go mod init example.com/m
  - task: GoTool@0
    inputs:
      version: '1.17'
 
  - task: CopyFiles@2
    displayName: "Copy files to ArtifactStaging"
    inputs:
      TargetFolder: '$(Build.ArtifactStagingDirectory)'
  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact"
    inputs:
       artifactName: drop


  - task: ArtifactoryGenericUpload@2
    inputs:
      artifactoryService: 'BasicAuth-artifactory'
      specSource: 'taskConfiguration'
      fileSpec: |
        {
          "files": [
            {
              "pattern": "*.*" ,
              "target": "default-generic-local/upload/"
            },
                        {
              "pattern": "*.yaml" ,
              "target": "default-generic-local/upload/"
            }
          ]
        }
      failNoOp: true
      
  - task: ArtifactoryGenericDownload@3
    inputs:
      connection: 'BasicAuth-artifactory'
      specSource: 'taskConfiguration'
      fileSpec: |
        {
          "files": [
            {
              "pattern": "default-generic-local/upload/*.go",
              "target": "c:\\download\\"
            }
          ]
        }
      failNoOp: true
